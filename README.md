 # sempfiross
                                                                      
Sempfiross - бот, работающий на методах vk_api.
Этот бот отвечает на поддерживаемые запросы в переписке.
Этот README является инструкцией по установке и использованию бота.

-----------------------------------------------------------------------

 # Команды бота:

* `!h`, `!help`, `!п`, `!помощь` — список команд.
* `!my_id`, `!ид` — ваш user_id.
* `!user_id`, `!пользователь @user` — информация о пользователе. 
* `!group_id`, `!группа {group_id}` — информация о сообществе.
* `!random {число}`, `!рандом {число}` — рандомное число.
* `!wiki`, `!вики {запрос}` — википедия.
* `!echo`, `!эхо` — бот начинает повторять за вами, чтобы это остановить, надо написать !echo off
* `!game`, `!игра камень/ножницы/бумага/статистика` — бот играет с вами в "Камень, ножницы, бумага" и ведет статистику игр.
* `!midnight`, `!полночь` — бот будет уведомлять о каждом миднайте по Московскому времени. Введите ещё раз, чтобы отменить это.
* `!subscribe`, `!подписаться` — бот будет уведомлять вас о каждом новом посте. Введите ещё раз, чтобы отменить это.
* `!debug`, `!дебаг` — бот отправляет информацию о своём состоянии.
* `!debug log`, `!дебаг лог` — бот отправляет последние 10 строк из своего лога.
* `!debug боты`, `!дебаг боты` — бот отправляет информацию об объектах бота в памяти.
* `!turnoff`, `!выкл` — выключение бота.
* `!admin_mode`, `!админмод` — бот переходит в режим модерации.
* `!ban`, `!бан @user` — исключает пользователя из беседы.
* `!resist`, `!запретить @user` — запрещает пользователю пользоваться ботом. Могут воспользоваться только администраторы.
* `!restore`, `!разрешить @user` — снова разрешает пользователю пользоваться ботом. Могут воспользоваться только администраторы.
* `!спаммер добавить @user` — добавляет пользователя в "базу спамеров".
* `!спамер удалить @user`, `!спаммер удалить @user` — убирает пользователя из "базы спамеров".

Чтобы воспользоваться функциями бота, необходимо отправить команду и в некоторых случаях аргумент. 
Все команды начинаются с восклицательного знака

-----------------------------------------------------------------------

# Установка/Запуск бота

Создаём бесплатный/платный аккаунт на [pythonanywhere](https://www.pythonanywhere.com/pricing/).
Можно, конечно, запускать бота в бесплатной консоли, но pythonanywhere может выключить вашу консоль, если вы долго не будете посещать её.

-----------------------------------------------------------------------

1. Заходим на [pythonanywhere](https://www.pythonanywhere.com/pricing/) и регистрируемся.
2. Создаём консоль Bash и прописываем туда: `git clone https://github.com/sempfira/sempfiross.git`
   Данная команда создаст отдельную папку с нашим репозиторием.
3. Теперь прописываем `cd sempfiross/`
   И устанавливаем необходимую библиотеку: `pip3 install vk-api pyowm Wikipedia-API --user`
   Данная команда установит все необходимые библиотеки для работы бота.

-----------------------------------------------------------------------

Настроим ваше сообщество для работы с ботом: заходим в Управление -> Работа с API. 
Здесь создаём токен сообщества с правами доступа к сообщениям, фотографиям и стене. 
Идем в Long Poll API, включаем его и ставим последнюю доступную версию (бот тестировался на версии 5.120). 
В Типы событий должны стоять галочки на следующих событиях: Входящее сообщение, Запрет на получение, Добавление записи на стене.

-----------------------------------------------------------------------

Создадим файл конфигурации для бота. 
В pythonanywhere тыкаем на Files, переходим в директорию `sempfiross` и создаём там новый файл с названием `config.py`. 
В нём должно быть написано следующее:

```
vk_group_token = "токен"
group_id = айди группы # Цифровой ид группы
owner_id = ваш айди # Цифровой ид вашей страницы вк, чтобы вы могли управлять ботом в переписке
admins = [админ1, админ2] # Список ид аккаунтов администраторов, которые в любом случае тоже смогут получать доступ к командам администрирования.
vk_service_token = "vk_service_token" # Сервисный ключ доступа для команды !image. Оставьте None, если хотите выключить эту команду
album_for_command = айди альбома # Цифровой ид альбома для команды !image. Оставьте None, если хотите выключить эту команду
```

----------------------------------------------------------------------

# Если вы будете использовать команду !image

Разберёмся с костылём для метода `photos.get`.
Идем на vk.com/dev, нажимаем на Мои приложения и кликаем по Создать приложение. 
Новое приложение может называться как угодно, от него нам необходимо всего лишь сервисный ключ доступа, который можно найти, если нажать на Настройки.

----------------------------------------------------------------------

# Запуск бота.

Если аккаунт платный: 
1. В pythonanywhere тыкаем на Tasks, создаём и запускаем в Always-on tasks задачу python3.8 /home/pythonanywhere_nickname/dan63047pythonbot/longpulling.py, где вместо    pythonanywhere_nickname должен быть ваш никнейм на pythonanywhere. 
2. После небольшого тупления pythonanywhere запустит вашего бота.

Если аккаунт бесплатный: 
1. В bash консоли переходим в директорию бота и прописываем `python3 longpulling.py`. 
2. Консоль можно оставить в покое, но лучше раз в день проверять её чтобы консоль не отключили.
